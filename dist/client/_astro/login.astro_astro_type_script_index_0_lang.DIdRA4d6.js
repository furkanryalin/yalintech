import{s as c}from"./supabase-client.F75ZvaDp.js";const g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function f(r){const n=r?.status,e=(r?.message||r?.error_description||r?.error||"").toLowerCase();return e.includes("invalid")&&e.includes("email")?"Geçerli bir e-posta adresi giriniz.":e.includes("user not confirmed")||e.includes("email not confirmed")||e.includes("confirmation")?"E-posta adresiniz doğrulanmamış. Lütfen e-postanızı kontrol edin veya doğrulama e-postasını yeniden gönderin.":e.includes("already registered")||e.includes("already exists")||e.includes("user already")?"Bu e-posta ile zaten kayıtlı bir hesap var.":e.includes("password")&&(e.includes("length")||e.includes("at least")||e.includes("too short"))?"Şifre en az 6 karakter olmalıdır.":e.includes("invalid login")||e.includes("invalid credentials")||e.includes("invalid password")||e.includes("invalid login credentials")?"E-posta veya şifre yanlış.":n===400?"Giriş isteği hatalı (400). Lütfen e-posta ve şifrenizi kontrol edin.":n===401?"Yetkisiz erişim (401). Lütfen tekrar giriş yapın.":n>=500?"Sunucu hatası. Bir süre sonra tekrar deneyin.":r.message||"Bir hata oluştu. Lütfen tekrar deneyin."}const d=document.getElementById("login-tab"),o=document.getElementById("register-tab"),u=document.getElementById("login-form"),m=document.getElementById("register-form");d?.addEventListener("click",()=>{d.classList.add("text-blue-brand","border-blue-brand"),d.classList.remove("text-gray-500","dark:text-gray-400","border-transparent"),o?.classList.remove("text-blue-brand","border-blue-brand"),o?.classList.add("text-gray-500","dark:text-gray-400","border-transparent"),u?.classList.remove("hidden"),m?.classList.add("hidden")});o?.addEventListener("click",()=>{o.classList.add("text-blue-brand","border-blue-brand"),o.classList.remove("text-gray-500","dark:text-gray-400","border-transparent"),d?.classList.remove("text-blue-brand","border-blue-brand"),d?.classList.add("text-gray-500","dark:text-gray-400","border-transparent"),m?.classList.remove("hidden"),u?.classList.add("hidden")});document.getElementById("login-submit")?.addEventListener("click",async()=>{const r=document.getElementById("login-email")?.value,n=document.getElementById("login-password")?.value,e=document.getElementById("login-error");if(!r||!n){e&&(e.textContent="Lütfen tüm alanları doldurun",e.classList.remove("hidden"));return}try{const{data:t,error:a}=await c.auth.signInWithPassword({email:r,password:n});if(a)throw a;if(t.user&&t.session)try{const{data:s,error:i}=await c.from("profiles").select("approved").eq("id",t.user.id).single();if(i&&i.code!=="PGRST205")throw i;if(s&&s.approved===!1){await c.auth.signOut(),e&&(e.textContent="Hesabınız admin onayı bekliyor. Onaylandıktan sonra giriş yapabilirsiniz.",e.classList.remove("hidden"));return}const l=new URLSearchParams(window.location.search).get("return")||"/";window.location.href=l}catch(s){console.error("Approval check error:",s);const i=new URLSearchParams(window.location.search).get("return")||"/";window.location.href=i}}catch(t){if(console.error("Login error full:",t),e){const a=f(t?.data||t||{});e.textContent=a,e.classList.remove("hidden")}}});document.getElementById("register-submit")?.addEventListener("click",async()=>{const r=document.getElementById("register-name")?.value,n=document.getElementById("register-email")?.value,e=document.getElementById("register-password")?.value,t=document.getElementById("register-error");if(!r||!n||!e){t&&(t.textContent="Lütfen tüm alanları doldurun",t.classList.remove("hidden"));return}if(!g.test(n)){t&&(t.textContent="Geçerli bir e-posta adresi giriniz.",t.classList.remove("hidden"));return}if(e.length<6){t&&(t.textContent="Şifre en az 6 karakter olmalıdır",t.classList.remove("hidden"));return}try{const a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:n,password:e})}),s=await a.json();if(!a.ok)throw new Error(s.error||s.message||"Kayıt başarısız");if(o&&o.classList.remove("border-blue-brand"),document.getElementById("register-error")){const l=document.getElementById("register-error");l.textContent="",l.classList.add("hidden")}alert(s.message||"Kayıt başarılı! Hesabınız admin onayı bekliyor.");const i=document.getElementById("login-email");i&&(i.value=n),d?.click()}catch(a){t&&(t.textContent=a.message||"Kayıt başarısız",t.classList.remove("hidden"))}});
